# IDE-backend testing

This folder contains integration tests developed using the BATS framework.
Test are executed invoking tdskt (Toradex Developer's Swiss Knife Tool) that uses the Python API to invoke the REST calls provided by the IDE backend.

Tests are implemented in the testcases folder and cover:
- general backend features (version, docker version)
- emulation (enabling it, needed to execute application/sample tests)
- eulas
- platforms
- applications (creating new and use some sample ones)
- devices

Some tests can be repeated per platform, device or on each sample, for those there are additional files with the _multi_ suffix.
Since splitting tests on multiple files or repeating them multiple times makes cleanup complex for some _multi_ tests there is also a _multi_teardown file that is used to delete containers and artifacts generated by the last iteration of the test. This will ensure that running the tests won't lead to a full HD or something similar.

## Running the tests

First you need to initialize the environment and install the BATS framework. To do this you can source the setup.sh script (on Windows this must be done in a WSL2 shell, but the binaries for the backend will run natively on Windows):

```bash
. ./setup.sh
```

On Windows the scripts use wslvar command, check if it's available and if not, install it as documented [here](https://github.com/wslutilities/wslu).

Then you can run the test suite by typing:

```
./run.sh
```

The behavior of the tests can be configured using some environment variables.

| variable | description |
|------------|----------------------------|
| TIE_REPORT | When set to "1" will generate a report file name YYYYMMDDhhmmss.log in the reports subfolder. Output of the IDE backend is also stored in a file with the same name and moses suffix. |
| TIE_TESTCASE | Can be used to execute a single test. The emulation and backend tests are always executed because they are needed to enable features required by other tests. |
| TIE_DEVICE | Should be set to execute tests that require connection to a device. You can set it to the ID (serial number) of a specific device configured on the system or to "*" to run the tests on all the configured devices. Not setting the variable or letting it empty would skip device-related tests |
| TIE_SERIAL_PORT | Can be configured to the serial port (/dev/tty* on linux, COM*: on Windows) used to detect a connected device, if not set, serial detection tests will be skipped. Device must use standard torizon/torizon username/password. |
| TIE_NETWORK_DEVICE | hostname or ip address of a device that will be detected over network. If not set, network detection tests will be skipped. Device must use standard torizon/torizon username/password. |
| TIE_DEBUG_BACKEND | When set to "1" will prevent backend startup and termination, tests will rely on a running instance of the backend, allowing its execution from a debugger. |

